# 📝 이미지 Extension 제작하기

## ❓ Tiptap 기본 이미지 Extension의 문제점
Tiptap이 제공하는 이미지 Extension은 다음과 같은 문제점이 있었다.

1. Editor에서 이미지를 선택해도 별도의 focus style이 적용되지 않는다.
2. 이미지 Resize를 지원하지 않는다.
3. 이미지 좌/우 정렬을 지원하지 않는다.

## 🔍 구조 설계

이 3가지를 모두 해결할 수 있는 구조에 대해 고민해보았다.

<img width="3584" height="1312" alt="image" src="https://github.com/user-attachments/assets/7880322b-5da2-4177-8fbc-cfcd3efda4a7" />

### inner Wrapper
- 이미지를 감싸는 Wrapper를 적용하며, 이미지의 크기에 딱 맞도록 설정한다.
- 이미지가 선택될 때 inner Wrapper에 border style을 적용해 시각적인 focus 스타일을 만들어준다.

### outer Wrapper
- inner Wrapper를 감싸는 Wrapper를 적용하며, Editor의 width 전체를 차지하도록 만든다.
- `display: flex` 와 `justify-content` style을 활용해 좌/우/가운데 정렬을 구현한다.

## 📜 구문 작성

먼저 새로운 노드를 생성할 때, 해당 노드에 어떤 속성을 적용할 것인지에 대한 정의 부터 해야한다.

먼저 이미지에는 기본적으로 `width`, `height`, `src` 속성은 기본으로 필요하고, `alt` 속성도 사용자 경험을 위해 있는게 좋을 것 같다.

`display: flex`와 `justify-content`는 style로 지정해줘도 되지만, 이렇게 하면 style의 값을 읽어서 `start`,`end`,`center` 값을 수정해줘야 하기 때문에
dataset 속성을 이용해 `align` 값을 명시해주는 방법을 선택했다.

- JSON 노드 속성: width, height, alt, src, align
- HTML 노드 속성: width, height, alt, src, data-align

> [!Note]
> https://github.com/codeit-fe16-part3-team1/project-w1k1ed-app/pull/98

이미지를 삽입하면 img 태그에 width, height 속성이 명시된다.

```html
  <img
    src="blob:https://team1-wikled-project-poguielii-chiyoung-kims-projects.vercel.app/9926e8de-8e4b-41d1-931b-24a90a705b08"
    alt="image.png"
    width="716"
    height="474"
  >
```

이미지 resize 시에는 이미지가 가로/세로 비율을 유지할 수 있도록 아래와 같이 매번 aspect Ratio를 재 계산해서 반영해주는 방식을 사용했다.

```ts
const handleMouseMove = (event: MouseEvent) => {
  const dx = event.clientX - startX;
  const newWidth = Math.min(Math.max(50, startWidth + dx), maxWidth);

  const aspectRatio =
    node.attrs.width && node.attrs.height
      ? node.attrs.width / node.attrs.height
      : startWidth / startHeight;

  const newHeight = newWidth / aspectRatio;

  img.style.width = `${newWidth}px`;
  img.style.height = `${newHeight}px`;
};
```

그리고 이미지가 Text Editor의 width 보다 커지지 않도록 아래와 같이 css를 작성했다.

```css
.text-editor img {
  width: auto; /* 원본 비율 유지 */
  object-fit: contain;
  display: block;
}
```

## 💡 작업 결과

- 이미지 선택 시 녹색 Border style 처리(focus style)
- resize handle로 크기 조절 가능
- 이미지 전용 툴바로 좌/우/가운데 정렬 적용 가능

![Animation](https://github.com/user-attachments/assets/0bc25875-ff73-4962-99e5-86cfe525117e)
