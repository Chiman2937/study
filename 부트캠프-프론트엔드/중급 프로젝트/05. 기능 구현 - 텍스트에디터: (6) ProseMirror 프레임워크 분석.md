# 📝 ProseMirror 프레임워크 분석

Tiptap은 ProseMirror 프레임워크 기반으로 동작하는 라이브러리로, Tiptap의 상태관리는 전적으로 ProseMirror 프레임워크에 의존한다.

따라서 Tiptap의 동작을 이해하려면 ProseMirror 프레임워크가 무엇이고, 어떻게 동작하는지를 이해하여야 한다.

<br></br>

## 🔍 ProseMirror란?

ProseMirror는 에디터의 “상태”, “동작”, “렌더링”을 통합적으로 설계·조작·관리할 수 있도록 설계된 웹 기반 리치 텍스트 에디터 아키텍처이다.

즉, 문서 상태를 구조화하고, 그 상태를 조작하고, 최종적으로 DOM에 렌더링하는 전체 흐름을 하나의 프레임워크로 제공하는 통합 시스템이다.

<br></br>

## 💡 ProseMirror의 핵심 목표
ProseMirror는 다음과 같은 목표를 달성하기 위해 설계되었다.
- 문서 상태를 구조적으로 정의
- 트랜잭션 기반으로 상태를 조작
- 정확하고 예측 가능한 방식으로 뷰를 렌더링
- 실시간 협업, 히스토리, 플러그인 확장 등을 지원

<br></br>

## 📌 ProseMirror의 구성 요소와 동작 순서

| 구성 요소          | 설명                                                                         |
| -------------- | -------------------------------------------------------------------------- |
| `Schema`       | 문서 구조를 정의 (어떤 노드/마크가 존재하는지, 어떤 속성을 가지는지 등)                                 |
| `Node`, `Mark` | 실제 문서의 구성 요소 (문단, 이미지, 링크 등)                                               |
| `EditorState`  | 현재 문서 상태 + 커서 위치 + 플러그인 상태 등 전체 에디터 상태                                     |
| `Transaction`  | 상태를 변경하는 명령 (ex. 텍스트 삽입, 노드 삭제 등)                                          |
| `EditorView`   | 상태를 실제 DOM으로 렌더링하고 사용자 입력을 감지하는 렌더링 계층                                     |
| `Plugin`       | 에디터에 기능을 추가하거나 상태에 반응하는 확장 시스템 (예: 히스토리, 키보드 단축키, collaborative editing 등) |

```
사용자 입력 / 명령어
      ↓
Transaction 생성
      ↓
새로운 EditorState 생성
      ↓
EditorView가 DOM 업데이트
```



## 🔧 ProseMirror 구성요소 파헤쳐보기

### ✔️ schema

schema는 ProseMirror에서 문서의 구조를 정의하는 핵심 구성 요소로, 어떤 `Node`와 `Mark`가 들어갈 수 있는지 정의한다.

#### ❓ Node와 Mark란?

ProseMirror에서 `Node`와 `Mark`는 둘 다 HTML의 노드 구조 개념에서 출발했지만, 문서 상태를 더 정밀하게 표현하기 위해 의미론적으로 분리된 개념이다.

| 구분       | 종류 (예시)                                                                           | 대응되는 HTML 요소                                                         | 설명                                                                        |
| -------- | --------------------------------------------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **Node** | `paragraph`, `heading`, `blockquote`, `image`, `codeBlock`, `listItem`, `table` 등 | `<p>`, `<h1>`, `<blockquote>`, `<img>`, `<pre>`, `<li>`, `<table>` 등 | 문서의 \*\*구조(Structure)\*\*를 형성하는 요소. 블록 또는 인라인 노드로 나뉘며 계층적 트리를 구성          |
| **Mark** | `bold`, `italic`, `underline`, `strike`, `link`, `code` 등                         | `<strong>`, `<em>`, `<u>`, `<s>`, `<a>`, `<code>` 등                  | 텍스트에 \*\*스타일이나 의미(Semantic Annotation)\*\*를 부여하는 요소. 노드 내부의 텍스트에 겹쳐 적용 가능 |
