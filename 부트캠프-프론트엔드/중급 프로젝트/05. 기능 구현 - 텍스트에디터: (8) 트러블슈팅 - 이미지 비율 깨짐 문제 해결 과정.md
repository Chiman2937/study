# 📝 트러블 슈팅 - 이미지 extension 문제 해결 과정

## 

지난 글에서 이미지 extension을 직접 만들어보고, resize나 정렬 기능까지 구현해보았다.

하지만 테스트 과정에서 심각한 오류가 하나 발생했다.

<br></br>

## ❓ inner Wrapper의 비율이 깨지는 문제

![Animation](https://github.com/user-attachments/assets/b2e53c78-aaf0-48e6-88c8-6c0632afa064)

반응형 디자인 테스트 과정에서 Text Editor의 width가 이미지의 width보다 작아질 때 inner Wrapper의 비율이 유지되지 않는 문제가 발생했다.

> 이미지 전용 미니 툴바의 위치도 정상적이지 않았지만, 이건 쉽게 해결이 가능했다.

<br></br>

### ⚠️ 원인: aspect-ratio의 부재에 의한 비율 유지 불가능

이미지가 Text Editor의 width 보다 커지지 않도록 아래와 같이 css를 작성했었다.

그러다보니 viewport에 따라 width는 정상적으로 변화하지만, height는 변하지 않아 비율이 깨지는 것이었다.

```css
.text-editor img {
  width: auto; /* 원본 비율 유지 */
  object-fit: contain;
  display: block;
}
```

<br></br>

### 💡 해결방법

에디터 에서는 `aspect-ratio`를 적용해 이미지 비율이 항상 유지되도록 만들고, html string으로 파싱할 때는 `width`만 포함하는 방식으로 해결해보기로 했다.

이미지가 웹서버에 한번 등록되면 이미지 정보에 `width`, `height`가 포함되기 때문에 `width`만 표기 / `height`는 `auto`로 제어하는 방법이 가장 편할 것이라고 생각했다.

<br></br>

#### 🧩 구조 설계와 구현

코드를 작성하기 전 어떤식으로 작업할 지 구조 설계부터 진행해보았다.

1. command에서 `width`와 `style: aspect-ratio`를 입력받아 이미지 추가

2. HTML String으로 파싱할 때는 `width`만 파싱

3. 다시 Editor에 DOM 요소로 읽어올 때는 이미지 리소스 자체(메타 데이터)의 `width`와 `height`를 읽어 `aspect-ratio`값으로 계산하여 파싱 (속성에 `width` & `aspect-ratio` 적용)

<img width="991" height="295" alt="image" src="https://github.com/user-attachments/assets/e78b98ef-8d18-4c0b-ba33-92be7ea68643" />
> 구조 설계 하는 김에 구문 흐름을 한번 더 익힐 겸 그림으로 정리해 보았다.

<img width="1437" height="264" alt="image" src="https://github.com/user-attachments/assets/e2b68c5d-4bb9-405a-a0fb-6a888d418643" />

코드 참고: https://github.com/codeit-fe16-part3-team1/project-w1k1ed-app/blob/e6903cc8074c1c6aa44a6480ac356d5f12946f9c/src/components/common/TextEditor/utils/extensions/LocalImageExtension.ts

<br></br>

## ✔️ 작업 결과

이미지 resize, 정렬, 그리고 반응형까지 정상적으로 대응되는 모습이다.

![Animation](https://github.com/user-attachments/assets/a6cb8082-82f5-422a-bf4c-95266dcf0f30)
